on:
  workflow_call:

jobs:
  build:
    name: "ğŸ›  Buildï¸"
    runs-on: ubuntu-latest
    container:
      image: node:24-alpine
    steps:
      - name: "âœ… Checkout repo"
        uses: actions/checkout@v4

      - name: "ğŸ“¦ Install tools"
        run: |
          #apk update
          apk add --no-cache nodejs openjdk21-jre yarn
          node --version
          yarn install
          mkdir dist_artifacts
          mkdir test_artifacts

      - name: "ğŸ”§ Build project"
        working-directory: dist_artifacts
        run: |
          yarn run closure-make
          NODE_PATH="$(cd "../node_modules" && pwd -P)" node ../wasmxlang.js --help

      - name: "ğŸ§ª Build tests"
        working-directory: test_artifacts
        run: |
          ../scripts/wasm2lang_build_tests.sh

      - name: "ğŸ§° Upload artifacts-tests artifact"
        uses: actions/upload-artifact@v4
        with:
          name: artifacts-tests
          path: ./test_artifacts
          if-no-files-found: error